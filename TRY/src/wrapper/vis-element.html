<link rel="import" href="../import/vis-import.html">

<dom-module id="vis-element">
  <template>
    <style>
      :host {
        display: block;
      }

      #mynetwork {
            width: 600px;
            height: 400px;
            border: 1px solid lightgray;
        }

      #config {

          width: 400px;
          height: 600px;
        }
    </style>

    <div id="mynetwork"></div>
  </template>
  <script>
    Polymer({
      is: 'vis-element',

      properties: {
        network: {
          type: Object
        },
        nodes: {
          type: Array
        },
        edges: {
          type: Object
        },
        networkOptions: {
          type: Object
        },
        configurationEnabled: {
          type: Boolean,
        }

      },

    attached : function(){
    // create an array with nodes
    var nodes = new vis.DataSet([
        {id: 1, label: 'Node 1'},
        {id: 2, label: 'Node 2'},
        {id: 3, label: 'Node 3'},
        {id: 4, label: 'Node 4'},
        {id: 5, label: 'Node 5'}
    ]);


    // create an array with edges
    var edges = new vis.DataSet([
        {from: 1, to: 3},
        {from: 1, to: 2},
        {from: 2, to: 4},
        {from: 2, to: 5}
    ]);

    // create a network
    var container = this.$.mynetwork;

    // provide the data in the vis format
    var data = {
        nodes: nodes,
        edges: edges
    };
    var options = {configure: true};

    // initialize your network!
    this.network = new vis.Network(container, data, options);
  },

    setNodes : function(nbNodes)
    {
      if(!Number.isNaN(nbNodes))
      {

        this.nodes = [];

        for(i = 0; i < nbNodes; i++)
        {
          this.nodes.push({
            id: i+1,
            label: 'Node '+(i+1)
          });

        }

        this.edges = [];

        var data = {
          nodes: this.nodes,
          edges: this.edges
        }

        var options={};
        var container = this.$.mynetwork;

        this.network = new vis.Network(container, data, options);

        //this.createEdgeBetween(1,2,'testdeloeuf');
        //this.completeNetwork();
        this.renameNode(1, 'wesh');
      }
    },

    /**
    * .createEdgeBetween creates an edge between two given nodes. If the link already exists, then nothing is done.
    * From the node1 to the node2
    *
    * @param {!required} node1 {String} First idnode to be linked, corresponding to the from.
    *
    * @param {!required} node2 {String} Second idnode to be linked, corresponding to the "to"
    *
    * @param {!required} edgeLabel {String} The label of the edge to be displayed .
    *
    * @method createLinkBetween
    */
    createEdgeBetween: function(node1, node2, edgeLabel)
    {
      //console.log(this.edges.length);
      for(i = 0; i < this.edges.length; i++)//If an edge already exists, it will not be recreated & the network must not be redraw
      {
        if( ((this.edges[i].to.localeCompare(node1) == 0) && (this.edges[i].from.localeCompare(node2) == 0) ) ||
            ((this.edges[i].to.localeCompare(node2) ==0) && (this.edges[i].from.localeCompare(node1) == 0) ) )
            {
              //console.log('returning');
              return;
            }
      }



      this.edges.push({
        from: node1,
        to: node2,
        label: edgeLabel
      });

      this.network.setData({
        nodes: this.nodes,
        edges: this.edges
      });

      this.network.redraw();

    },

    /**
    * Complete the network, ie. draw all the edges between each nodes. The lowest id goes to the highest. Non-oriented graph
    *
    * @method completeNetwork
    */
completeNetwork: function()
    {

      for(k = 0; k < (this.nodes.length - 1); k++)
      {
        for(j = k+1; j < this.nodes.length; j++)
        {
          this.createEdgeBetween(this.nodes[k].id+"", this.nodes[j].id+"", "");
        }
      }

      this.networkOptions = {layout: {
        improvedLayout: false
      }};

      //@TODO : Ajouter aux options !
      this.network.setOptions(this.options);
    },

 /**
 * Rename a node with the name provided..
 *
 * @param {!required} node {String} The id of the node to be rename.
 *
 * @param {!required} name {String} The new name of the node..
 *
 * @method renameNode
 */
renameNode: function(node, name)
 {
   for(var i = 0; i < this.nodes.length; i++)
   {
     if(this.nodes[i].id == node)
     {
       this.nodes[i].label = name;

       this.network.setData({
         nodes: this.nodes,
         edges: this.edges
       });

       this.network.redraw();

       return;
     }
   }
 },

    /**
    * .
    *
    * @param {!required} enabled {String} If the configuration panel has to be enabled.
    *
    * @method enableConfiguration
    */
enableConfiguration: function(enabled)
    {
      //@TODO : Editer les options de vis. Utiliser : setOptions()
      this.configurationEnabled = enabled;
    },



});
  </script>
</dom-module>
