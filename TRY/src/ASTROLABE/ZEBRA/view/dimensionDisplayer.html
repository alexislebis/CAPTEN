<link rel="import" href="../../../../../bower_components/brainy-table/brainy-table.html">
<link rel="import" href="./tokensDisplayer.html">
<link rel="import" href="./htmlResponseBuilder.html">

<dom-module id="dimension-displayer">
  <template>
    <style>

    </style>

    <div id="dimension">
        <h4>DIMENSION: {{name}}</h4>

      <tokens-displayer id="tokenDisplayer" dimension={{tokensOfResult}}></tokens-displayer>

      <brainy-table id="a" items="[[resultArray]]" page-size="7" details-enabled>
        <brainy-table-column name="Priority Score" filter-by="priorityScore" sort-by="priorityScore">
          <template>[[item.priorityScore]]</template>
        </brainy-table-column>
        <brainy-table-column name="Token coverage (#)" filter-by="nbTokenAns" sort-by="nbTokenAns">
          <!-- <template>[[_computeTokenCoverage(item.nbTokenAns)]]</template> -->
          <template>[[item.nbTokenAns]]</template>
        </brainy-table-column>
        <brainy-table-column name="ID" filter-by="id" sort-by="id">
          <template>[[item.id]]</template>
        </brainy-table-column>
        <brainy-table-column name="Type" filter-by="type" sort-by="type">
          <template>[[item.type]]</template>
        </brainy-table-column>
        <brainy-table-column width="30px" align-right flex="0">
          <template>
            <template is="dom-if" if="[[!expanded]]">
              <iron-icon icon="icons:expand-more"></iron-icon>
            </template>
            <template is="dom-if" if="[[expanded]]">
              <iron-icon icon="icons:expand-less"></iron-icon>
            </template>
          </template>
        </brainy-table-column>
        <template is="row-detail" bind="_testAttached">
          <div>
            <div id="resultDetail">
              <html-response-builder item="{{item}}" parent="{{parent}}"></html-response-builder>
            <!-- [[_updateHTMLForOneID(item.trueID)]] [[item.id]], [[item.id]], [[item.id]] -->
            </div>
            <paper-button raised on-click="_testClick">CLICK TO REQUERY</paper-button>
          </div>
        </template>
        <div no-results>No results found. Click here</div>
      </brainy-table>
    </div>

  </template>
  <script>
    Polymer({
      is: "dimension-displayer",

      properties:
      {
        resultArray:
        {
          type: Array,
          notify: true,
        },

        tokensOfResult:
        {
          type: Array,
          notify: true,
        },

        parent:
        {
          type: Object,
          notify: true,
        },
        name:
        {
          type: String,
          notify: true,
        },
      },

      observers:
      [
        "_onRAChange(resultArray)",
      ],

      attached: function()
      {
        this.$.tokenDisplayer.addEventListener(TOKEN_PRIORITY_CHANGE_ID, function(e)
        {
          this._refire();
        }.bind(this));
      },

      _onRAChange: function(rA)
      {
        console.log(this.resultArray);
      },

      update: function()
      {
        var tmp = this.resultArray;
        this.resultArray = null;
        this.resultArray = tmp;
      },

      _refire: function()
      {
        // this.fire(DIMENSION_DISPLAYER_REQUIRE_UPDATE_SIGNAL_ID, {RPR: this.parent, TOR: this.tokensOfResult, RA: this.resultArray});
        this.fire(DIMENSION_DISPLAYER_REQUIRE_UPDATE_SIGNAL_ID, {DIM: this.name});
      },

    });
  </script>
</dom-module>
