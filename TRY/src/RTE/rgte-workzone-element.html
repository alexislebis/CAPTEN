<link rel="import" href="../wrapper/rgte-model-element.html">
<link rel="import" href="../RTE/rte-lister-element.html">
<link rel="import" href="../RTE/rgte-element.html">
<link rel="import" href="../RTE/rgte-saver-xml-element.html">
<link rel="import" href="../RTE/rgte-file-reader-element.html">

<link rel="import" href="../../../bower_components/iron-form-element-behavior/iron-form-element-behavior.html">

<dom-module id="rgte-workzone-element">
    <template>
        <style>
            :host {
                display: block;
            }
        </style>

        <div hidden$="{{disableLoadMenu}}">
          <rgte-file-reader-element id="rgteReader" rgte="{{rgte}}" vocab="{{vocab}}" customcls="{{customcls}}" customprops="{{customprops}}"></rgte-file-reader-element>
        </div>

        <div hidden$="{{disableLister}}">
          <rte-lister-element id="rteList" vocab="{{vocab}}" rgte="{{rgte}}" customcls="{{customcls}}" customprops="{{customprops}}" disable-Adding="{{disableAdding}}" disable-Classes-Lister="{{disableClassesLister}}" disable-Properties-Lister="{{disablePropertiesLister}}"></rte-lister-element>
        </div>

        <rgte-element id="rgte" rgte="{{rgte}}" disable-Cardinality="{{disableCardinality}}" enable-Modification="{{enableModification}}"></rgte-element>


        <div  hidden$="{{isHidden}}">
          <rgte-saver-xml-element id="xmlSaver" rgte="{{rgte}}" vocab="{{vocab}}"></rgte-saver-xml-element>
        </div>

        <div hidden$="{{disableSaveMenu}}">
          <div hidden$="{{!isHidden}}">
          <paper-button raised on-tap="_saveRGTEToXML" >Save Menu</paper-button>
          </div>
        </div>

        <div hidden$="{{disableBagMenu}}">
          <paper-button raised on-click="_generateAddRGTE">Add current RGTE to the "bag"</paper-button>

          <paper-dialog on-iron-overlay-closed="_isAccepted" id="OnlyOneRGTEATM" modal>
              <h2>Only one RGTE in the bag</h2>
              <p>Currently, you cannot use more than one RGTE simultaneously in the description of an AP. Try to complete your RGTE instead.
              <br/>Nothing happens.</p>
              <div class="buttons">
                  <paper-button dialog-dismiss autofocus>Abort</paper-button>
                  <paper-button dialog-confirm autofocus>Replace :'(</paper-button>
              </div>
          </paper-dialog>
        </div>

      </template>
    <script>
        Polymer(
        {
            is: 'rgte-workzone-element',

            properties:
            {
                isHidden:
                {
                    type: Boolean,
                    value: true,
                    notify: true,
                },
                rgte:
                {
                    type: Object,
                    value: function()
                    {
                        return new RGTE();
                    },
                    notify: true,
                    observer: "_test",
                },

                vocab:
                {
                    type: Object,
                },
                customcls: //used for file-reader
                {
                    type: Array,
                    notify: true,
                },
                customprops:
                {
                    type: Array,
                    notify: true,
                },

                // === FEATURES BEHAVIORS
                disableSaveMenu:
                {
                  type: Boolean,
                  notify: true,
                  value: false,
                },
                disableBagMenu:
                {
                  type: Boolean,
                  notify: true,
                  value: false,
                },
                disableLoadMenu:
                {
                  type: Boolean,
                  notify: true,
                  value: false,
                },
                disableLister:
                {
                  type: Boolean,
                  notify: true,
                  value: false,
                },
                disableAdding://Used in the RGTE LISTER for prevent addition of new element
                {
                  type: Boolean,
                  notify: true,
                  value: false,
                },
                disableCardinality:
                {
                  type: Boolean,
                  value: false,
                  notify: true,
                },
                enableModification:
                {
                  type: Boolean,
                  value: false,
                  notify: true,
                },
                disableClassesLister:
                {
                  type: Boolean,
                  value: false,
                  notify: true,
                },
                disablePropertiesLister:
                {
                  type: Boolean,
                  value: false,
                  notify: true,
                },

            },

            behaviors: [
              Polymer.IronFormElementBehavior
            ],

            attached: function()
            {
                this.$.rteList.addEventListener('-ClassAddedToRGTE', function(e)
                {
                    this.$.rgte.classDispatcherBehavior(e.detail.val);
                }.bind(this));

                this.$.rteList.addEventListener('-PropAddedToRGTE', function(e)
                {
                    this.$.rgte.propertyDispatcherBehavior(e.detail.val);
                }.bind(this));

                this.$.rgte.addEventListener('MANAGE_LISTER_VISIBILITY', function(p){
                  this.disableLister = p.detail.isListerDisable;
                  this.disableAdding = p.detail.isListerAddingDisable;
                  this.disableClassesLister  = p.detail.isClassesListerDisable;
                  this.disablePropertiesLister = p.detail.isPropertiesListerDisable;
                }.bind(this));

            },

            _test: function()
            {
              console.log("In change");
            },

            _generateAddRGTE: function()
            {
                this.$.OnlyOneRGTEATM.open();

                // console.log("DELETE BELOW");
                // this.rgte.parseJSON('lol','1');
            },

            _saveRGTEToXML: function()
            {
                this.isHidden = false;
                // this.$.xmlSaver.save(this.network);
            },

            _isAccepted: function(e)
            {
                if (!e.detail.confirmed)
                    return;

                //var RGTE = {network: this.$.rgte.getNetwork(), cardinality: this.$.rgte.getEdgesCardinality()};
                this.fire("-RGTEAddedToTheBag", this.rgte);
            },

            _computeHidden: function(isHidden)
            {
                console.log("cH:" + isHidden);
                return isHidden;
            },

            notifyRGTEChange: function()
            {
              var rgte = this.rgte;
              this.rgte = null;
              this.rgte = rgte;
            },

        });
    </script>

</dom-module>
