<link rel="import" href="../wrapper/rdfstore-element.html">
<link rel="import" href="../../bower_components/iron-list/iron-list.html">
<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../bower_components/iron-collapse/iron-collapse.html">

<dom-module id="rdf-store-lister-element">
    <template>
        <style>
            :host {
                font-family: sans-serif;
            }

            .content {
                @apply(--layout-vertical);
                height: 100%;
            }

            .pad {
                @apply(--layout-flex);
                @apply(--layout-vertical);
                padding: 0 16px;
            }

            .item {
                @apply(--layout-horizontal);
                cursor: pointer;
                padding: 16px 22px;
                border-bottom: 1px solid #DDD;
            }

            .item:focus,
            .item.selected:focus {
                outline: 0;
                background-color: #ddd;
            }

            .item.selected .star {
                color: var(--paper-blue-600);
            }

            .item .star {
                color: var(--paper-blue-600);
            }

            .star {
                width: 24px;
                height: 24px;
            }

            iron-list {
                @apply(--layout-flex);
            }
        </style>
        <div id="rdflister">
            <div>
                <h2 on-tap="_toggleRDFClasses">Available Classes</h2>
                <!-- <ul id="rdfClasses"></ul> -->
                <iron-collapse id="classRDFCollapse">

                <iron-list id="ilRDFC" items="[[rdfclasses]]" as="item" class="flex" selection-enabled>
                    <template>
                        <div>
                            <div class$="[[_computeClass(selected)]]" on-tap="_rdfcTapped">
                                <div class="primary pad" tabindex$="[[tabIndex]]">[[item.uri]]</div>
                                <div class="selectedItem">
                                    <iron-icon icon$="[[iconForItem(selected)]]" class="star"></iron-icon>
                                </div>

                            </div>
                            <iron-icon class="makeRelation" icon="swap-vert" on-tap="_makeRelTapped"></iron-icon>
                            <div class="border"></div>
                        </div>
                    </template>
                </iron-list>

                </iron-collapse>
              </div>

    <div>
        <h2 on-tap="_toggleRDFProps">Availablle Properties</h2>

        <iron-collapse id="propRDFCollapse">


        <iron-list id="ilRDFP" items="{{_toArray(rdfprops)}}" as="item" class="flex" selection-enabled>
            <template>
                            <div>
                                <div class$="[[_computeClass(selected)]]" on-tap="_rdfpTapped">
                                    <div class="primary pad" tabindex$="[[tabIndex]]">[[item.value.uri]]</div>
                                    <div class="selectedItem">
                                        <iron-icon icon$="[[iconForItem(selected)]]" class="star"></iron-icon>
                                    </div>
                                </div>
                                <div class="border"></div>

                        </template>
              </div>
              </iron-list>
          </iron-collapse>
    </div>
    </div>
    </template>
    <script>
        Polymer(
        {
            is: 'rdf-store-lister-element',

            properties:
            {
                rdfclasses:
                {
                    type: Array,
                    notify: true,
                    value: function()
                    {
                        return [];
                    },
                },

                rdfprops:
                {
                    type: Array,
                    notify: true,
                    value: function()
                    {
                        return [];
                    },
                },

                vocab:
                {
                    type: Object,
                    // value: function(){return new CONTROLLED_VOCABULARY();},
                },

                // selectedcls:
                // {
                //   type: Object,
                //   notify: true,
                // },
                // selectedprop:
                // {
                //   type: Object,
                //   notify: true,
                // },
            },
            //
            // observers: [
            //     "_onRdfclassesChanged(rdfclasses.splices)",
            //     "_onRdfpropertiesChanged(rdfprops.splices)",
            // ],

            attached: function()
            {
                this.vocab.registerObserverCallbackOnChange(this, this._onVocabularyChange);
            },

            // === PRIVATE METHODS ===
            _onVocabularyChange: function()
            {
                console.log(this.vocab.classes);
                this._onRdfclassesChanged(null);
                this._onRdfpropertiesChanged(null);
            },

            _toggleRDFClasses: function()
            {
              this.$.classRDFCollapse.toggle();
            },

            _toggleRDFProps: function()
            {
              this.$.propRDFCollapse.toggle();
            },

            _iterateOnClasses: function(vocab)
            {
                console.log("yo");
                return vocab.getClasses();
            },

            _onRdfclassesChanged: function(change)
            {
                console.log("rdfclssChanged");

                //this.set('rdfclasses', this.vocab.getClasses());
                this.rdfclasses = [];
                this.rdfclasses = this.vocab.getClasses();

                console.log(this.vocab.getClasses());

                Polymer.dom(this.root).querySelector('#ilRDFC').notifyResize();
                //document.querySelector('iron-list').notifyResize();
            },

            _onRdfpropertiesChanged: function(change)
            {
                this.rdfprops = [];
                // this.set('rdfprops', this.vocab.getProperties());
                console.log(this.vocab.getProperties());
                this.rdfprops = this.vocab.getProperties();
                console.log(this.rdfprops);

                Polymer.dom(this.root).querySelector('#ilRDFP').notifyResize();
            },

            _computeClass: function(isSelected)
            {
                return isSelected ? 'item selected' : 'item';
            },

            _rdfcTapped: function(e)
            {
                console.log(e.model.item);

                if (!e.model.selected) //If the item is selected
                    this.fire("ClassSelected", e.model.item);
                else
                {
                    this.fire("ClassDeselected",
                    {});
                }
            },
            _rdfpTapped: function(e)
            {
                console.log(e.model.item);

                if (!e.model.selected) //If the item is selected
                    this.fire("PropSelected", e.model.item.value);//Here we used .value because rgte has a map of properties and it is parsed with this._toArray(obj), producing a name & a value !
                else
                {
                    this.fire("PropDeselected",
                    {});
                }
            },

            _makeRelTapped: function(e)
            {
              this.fire("-MakeRelTapped");
            },

            _toArray: function(obj)
            {
                return Object.keys(obj).map(function(key)
                {
                    return {
                        name: key,
                        value: obj[key]
                    };
                });
            },

            // ===

            iconForItem: function(isSelected)
            {
                return isSelected ? 'check-circle' : 'radio-button-unchecked';
            },


            getClassListing: function()
            {
                return Polymer.dom(this.root).querySelector('#ilRDFC');
            },

            getPropsListing: function()
            {
                return Polymer.dom(this.root).querySelector('#ilRDFP');
            },

            clearClsSelection: function()
            {
                this.$.ilRDFC.clearSelection();
            },
            clearPropSelection: function()
            {
                this.$.ilRDFP.clearSelection();
            },
        });
    </script>
</dom-module>
