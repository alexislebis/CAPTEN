<dom-module id="operation-search-element">
  <template>
    <style>

    #searchZone{
      @apply(--layout-horizontal);
      margin-bottom: 50px;
    }

    #searchZone paper-searchbox{
      @apply(--layout-flex);
      --paper-searchbox-background: var(--paper-searchbox-dark-background);
      --paper-searchbox-color: black;
    }

    #divRoot{
      width: 60%;
      margin: 0 auto;
    }

    #new{
      @apply(--layout-vertical);
      @apply(--layout-center);
      margin-bottom: 50px;
    }

    </style>

    <app-location route="{{routeTopLevel}}" use-hash-as-path></app-location>

<div id="divRoot">

  <div id="new">
    <paper-button raised on-click="_openNew">Create a new narrated operator</paper-button>
  </div>

    <div id="searchZone" hidden="{{_computeHiddenAssumption(itemElmt)}}">
      <paper-searchbox raise-forced="true" placeholder="Search operation" value="{{query}}"></paper-searchbox>
      <paper-button raised disabled>Show search options</paper-button>
    </div>

  <div id="result">
    <div id="normal">
      <header class="headerSubSection">
        <div><span><h3>{{_computeHeaderName(query)}}</h3></span></div>
      </header>
  <!--  -->
    <template id="repeater" is="dom-repeat" items="{{operationsArray}}" filter="{{computeFilter(query)}}" index-as="index" restamp>
        <operator-displayer-element enable-use="{{enableUse}}" operator="{{item}}"><opeator-displayer-element>
    </template>
    </div>
    <div id="previous">
      <header class="headerSubSection">
        <div><span>Previous operations used</span></div>
      </header>
    </div>
    <div>
      <header class="headerSubSection">
        <div><span>Suggested operations</span></div>
      </header>
    </div>

    (note:lier nop avec voc pour leur type pour emergence des relations)
  </div>
</div>

  </template>
  <script>
    Polymer(
    {
      is: 'operation-search-element',

      properties:{
        operationsArray:
        {
          type: Object,
          notify: true,
        },

        routeTopLevel: Object,

        query : String,
      },

      // observers: [
      //   "_onRouteChanged(route)",
      // ],

      _openNew: function()
      {
        this.set('routeTopLevel.path', '/nop/new');
      },

      // _onRouteChanged: function(route)
      // {
      //   if(route.path != "/operation_search")
      //     return null;
      //
      //
      //   //@HACK force dom repeat redraw
      //   this.operationsArray = [];
      //   this.$.repeater.render();
      //   //===
      //
      //   this.operationsArray = NARRATED_OPERATION_POOL.getAvailableOperations();
      //
      //   this.$.repeater.render();
      //
      // },
      //
      attached: function()
      {
        //@HACK force dom repeat redraw
        this.operationsArray = [];
        this.$.repeater.render();
        //===

        this.operationsArray = NARRATED_OPERATION_POOL.getAvailableOperations();

        this.$.repeater.render();
      },

      update: function()
      {
        //@HACK force dom repeat redraw
        this.operationsArray = [];
        this.$.repeater.render();
        //===

        this.operationsArray = NARRATED_OPERATION_POOL.getAvailableOperations();

        this.$.repeater.render();
      },

      computeFilter: function(query)
      {
        if(!query || query == null)
          return null;
        else {
          query = query.toLowerCase();
          return function(item){
            return (item.usualName.toLowerCase().includes(query));
          };
        }
      },

      _updateOperationsArray: function()
      {
        // this.operationsArray = [];
        // this.set('operationsArray', NARRATED_OPERATION_POOL.getAvailableOperations());
      },

      _computeHeaderName: function(query)
      {
        return query.length == 0 ? 'Operations' : 'Search results';
      },

    });
  </script>
</dom-module>
