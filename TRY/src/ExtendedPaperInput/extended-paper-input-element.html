<link rel="import" href="../../bower_components/iron-icons/editor-icons.html">
<!-- <link rel="import" href="../../bower_components/iron-input/iron-input.html"> -->

<dom-module id="extended-paper-input-element">
  <template>
    <style>
    </style>

    <paper-input id="input" label="{{label}}" value="{{typedText}}">
      <paper-icon-button suffix id="linker" icon="editor:insert-link" on-click="_linking"></paper-icon-button>
    </paper-input>


    <paper-tooltip for="linker">Highlight the element you want to identify then click here.</paper-tooltip>

    <paper-dialog on-iron-overlay-closed="_selectVoc" id="selectVoc" modal>
        <h2>Choose an element to link</h2>
        <vocabulary-lister-element id="vle" disable-browsing vocab="{{vocab}}" customcls="{{customcls}}" customprops="{{customprops}}"></vocabulary-lister-element>
        <div class="buttons">
            <paper-button dialog-dismiss>Close</paper-button>
            <!-- <paper-button dialog-confirm autofocus>Add</paper-button> -->
        </div>
    </paper-dialog>

  </template>
  <script>
    Polymer({
      is: "extended-paper-input-element",

      properties:
      {
        label:
        {
          type: String,
          notify: true,
        },

        value:
        {
          type: String,
          notify: true,
        },

        typedText:
        {
          type: String,
          notify: true,
        },

        vocab:
        {
          type: Object,
          notify: true,
        },
        customcls:
        {
          type: Object,
          notify: true,
        },
        customprops:
        {
          type: Object,
          notify: true,
        },
        linkedElement:
        {
          type: Object,
          notify: true,
        },
        tmpExtendedString:
        {
          type: Object,
          notify: true,
          value: function(){return new ExtendedString();},
        }
      },

      observers:
      [
        "_onTypedText(typedText.*)",
        "_onLinkedElementChanged(linkedElement)",
      ],

      attached: function()
      {
        this.$.vle.addEventListener(VOCABULARY_ELEMENT_SELECTED_SIGNAL_ID, function(e){
          // this.isNewElement = true;
          this.linkedElement = e.detail.element;
          this.$.selectVoc.close();
        }.bind(this));
      },

      _onTypedText: function(text)
      {
        console.log(text);
      },

      _onLinkedElementChanged: function(element)
      {
        if(element == null)
          return;

        this.tmpExtendedString.add(element);

        this.linkedElement = null;

        console.log(this.tmpExtendedString.getString());
      },

      _linking: function()
      {
        this.$.selectVoc.open();
      },

      _selectVoc: function(e)//NTD on close
      {
        // if (e.target.id == "selectVoc" && e.detail.confirmed)//Add new prop
        // {
        //     this.push('props',this.currentProp);
        // }
        // else
        // { //Otherwise the user don't want to bind prop, thus it has to be reset
        //
        // }
      },

    });
  </script>
</dom-module>
